"""
Message Types Module.

This module provides classes representing different message types used in the TabletopMagnat application.
Each class inherits from `BaseMessage` and defines a specific role (User, Assistant, System).
The classes also include a method to convert the message to a dictionary format suitable for external APIs.

Classes:
    UserMessage: Represents a message sent by the user.
    AssistantMessage: Represents a message generated by the assistant.
    SystemMessage: Represents a system-level message used for internal instructions or context.
"""

from typing import override

from openai.types.chat import ChatCompletionMessageFunctionToolCall
from pydantic import Field

from tabletopmagnat.types.messages.base_message import BaseMessage
from tabletopmagnat.types.messages.message_roles import MessageRoles
from tabletopmagnat.types.messages.tool_message import ToolMessage


class AiMessage(BaseMessage):
    """
    A message class for assistant responses.

    Attributes:
        role (MessageRoles): The role of the message sender, fixed to `MessageRoles.ASSISTANT`.

    Methods:
        to_dict(): Converts the message into a dictionary with 'role' and 'content' keys.
    """

    role: MessageRoles = MessageRoles.ASSISTANT
    tool_calls: list[ChatCompletionMessageFunctionToolCall] | None = Field(default=None)
    internal_tools: list[ToolMessage] = Field(exclude=True, default_factory=list)

    @override
    def to_dict(self):
        """
        Converts the message into a dictionary format.

        Returns:
            dict: A dictionary with 'role' and 'content' keys.
        """
        return {"role": str(self.role.value), "content": self.content, "tool_calls": self.tool_calls}
